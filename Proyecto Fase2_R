library(arules)
library(ggplot2)
library(readxl)
library(utf8)
library(tidyverse)
library(janitor)
library(rpart)
library(rpart.plot)


ruta <- "C:\\Users\\Daniel\\Downloads\\data"   
archivos <- list.files(ruta, pattern = "\\.xlsx$", full.names = TRUE)

leer_limpio <- function(path){
  read_excel(path) |> 
    clean_names() |> 
    mutate(source_file = basename(path))
}
base_unificada <- map_dfr(archivos, leer_limpio)

base_unificada <- base_unificada |>
  mutate(
    ano = as.integer(ano),
    mes = as.character(mes),
    edad = as.integer(edad)
  ) |>
  distinct()

datos <- select(base_unificada, -last_col())

data <- datos %>%
  rename(
    pueblo_pertenencia = ppertenencia,
    periodo_edad = periodoeda,
    municipio_residencia = muniresiden,
    tipo_consulta = tc,
    causa_atencion = caufin
    
  )

#PARTE 1 ARBOLES DE DECISION
#Caso 1: Emergencias en la capital
datos_mayores_emergencias <- subset(data, tipo_consulta == 3)
datos_mayores_emergencias <- subset(datos_mayores_emergencias, deptoresiden == 1)
datos_mayores_emergencias <- subset(datos_mayores_emergencias, causa_atencion != 'A099')
arbol1 <- rpart( sexo ~ 
                   edad +
                   mes + 
                   causa_atencion ,
                 data = datos_mayores_emergencias, method = "class"
)
rpart.plot(arbol1, type = 2, extra =0, under = TRUE, fallen.leaves =TRUE, box.palette ="BuGn",
           main ="Causa de atencion", cex = 0.5
           
)










